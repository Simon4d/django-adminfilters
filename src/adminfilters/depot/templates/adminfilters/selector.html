{% extends "adminfilters/_wrapper.html" %}{% load i18n %}
{% block title %}
    <h3>{% blocktrans with title as filter_title %}{{ filter_title }} {% endblocktrans %}
{#        <span class="opener"></span>#}
    </h3>{% endblock %}
{% block content %}
    <ul id="FilterDepotManager">
        <li>
            <select id="adminfilters_picker" style="width: 100%">
                {% if not spec.selected %}<option></option>{% endif %}
            {% for c in choices %}
                <option
                        data-qs="{{ c.query_string }}"
                        value="{{ c.pk }}" {% if c.selected %}selected="selected"{% endif %}>{{ c.name }}</option>
            {% endfor %}</select>
        </li>
        {% if spec.can_add_filter and not spec.selected %}
        <li><input id='adminfilters_saver'
                   {% if spec.query_string == "?" %}disabled="disabled"{% endif %}
                   type="text" style="width: 95%"/>
        </li>
        <li style="display: inline-flex;width: 100%">
            <a class="filter-jsonfield adminfilters button save"
               {% if spec.query_string == "?" %}disabled="disabled"{% endif %}
               style="width: 100%"
               href="#">{% if spec.selected %}{% trans "update" %}{% else %}{% trans "add" %}{% endif %}</a>
        </li>
        {% endif %}

    </ul>
{% endblock %}
{% block script %}
    <script type="text/javascript">
        ;(function ($) {
            $(document).ready(function () {
                $("#adminfilters_picker").on("change", function (e) {
                    var $option = $("#adminfilters_picker option:selected");
                    var qs = $option.data("qs");
                    if (qs) {
                        var url = qs + "&{{ spec.parameter_selection }}=" + $(e.target).val();
                        location.href = qs;
                    }
                });
                var saveAs = function(value){
                    var url = "{{ spec.query_string|safe }}&{{ spec.parameter_newname }}=" +value;
                    location.href = url;
                };
                $("#FilterDepotManager a.button.save").on("click", function (e) {
                    saveAs($("#adminfilters_saver").val());
                });
                $("#adminfilters_saver").on("keypress", function (e) {
                    if (e.which === 13) {
                        saveAs(this.value);
                    }
                });
            });
        })(django.jQuery);
    </script>
{% endblock %}
